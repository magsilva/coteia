<chapter id="installing">

	<title>Installing</title>

	<section id="installing-introduction">
		<title>
			Introduction
		</title>

		<para>
			CoTeia can be installed in a computer running  Windows or Linux (or any
			POSIX compatible) operational system. The recommended plataform is Linux
			and specific instructions for installing under the latest stable Debian or
			Conectiva GNU/Linux distributions are available. Although Windows is
			supported, some	of the latest features may lag behind: these will be
			documented within	this document.
		</para>
	</section>

	<section id="installing-requirements">
		<title>
			Requirements
		</title>

		<para>
			There are listed below the required software to run the CoTeia. Each item
			is identified with the URL for its home-page, the minimum version
			required and the version tested by the developers (and, therefore,
			recommended).

			Whenever a version is written with an "x", like "2.0.x", the letter "x"
			means any possible number. For example, "2.0.1" or "2.0.22" would be valid
			versions.
		</para>

		<para>
			<itemizedlist>
				<listitem>
					<para>
						<ulink url="http://incubadora.fapesp.br/projects/coteia/">CoTeia</ulink> (&min-coteia-ver;/&rec-coteia-ver;).
					</para>
				</listitem>

				<listitem>
					<para>
						<ulink url="http://httpd.apache.org/">Apache HTTPd Server</ulink> (&min-httpd-ver;/&rec-httpd-ver;).
					</para>
				</listitem>

				<listitem>
					<para>
						<ulink url="http://www.php.net/">PHP</ulink> (&min-php-ver;/&rec-php-ver;).
					</para>
				</listitem>

				<listitem>
					<para>
						<ulink url="http://www.cvshome.org/">CVS</ulink> (&min-cvs-ver;&rec-cvs-ver;), recommended for Linux or Unix, or <ulink url="http://www.cvsnt.org">CVSnt</ulink> (&min-cvsnt-ver;&rec-cvsnt-ver;), recommended for Windows.
					</para>
				</listitem>

				<listitem>
					<para>
						<ulink url="http://www.mysql.com/">MySQL</ulink> (&min-mysql-ver;/&rec-mysql-ver;)
					</para>
				</listitem>

				<listitem>
					<para>
						<emphasis>(optional)</emphasis><ulink url="http://java.sun.com">Java Runtime Environment 2</ulink>	(&min-jre-ver;/&rec-jre-ver;)
					</para>

					<important>
						<para>
							The Java Runtime Environment is used for XML transformation (XSLT) when PHP hasn't
							support for XSLT enabled.
						</para>
					</important>
				</listitem>

			</itemizedlist>
		</para>
	</section>


	<section id="installing-configuration">
		<title>
			Configuration
		</title>
	

		<section id="installing-configuration-httpd">
			<title>
				Configuring the Apache HTTPd
			</title>
	
			<para>
				The HTTPd server's hostname and listening port are needed to configure
				CoTeia. These information can be gathered from <filename>httpd.conf</filename>,
				usually installed into the Apache's server root.
			</para>

			<para>
				The server's hostname must be a valid Internet name (e.g. www.google.com) or
				the machine IP's address (e.g. 200.250.8.1). The parameter "ServerName" holds
				the default HTTP server's name:
			</para>

			<programlisting>
#
# ServerName allows you to set a host name which is sent back to clients for
# your server if it's different than the one the program would get (i.e., use
# "www" instead of the host's real name).
#
# Note: You cannot just invent host names and hope they work. The name you 
# define here must be a valid DNS name for your host. If you don't understand
# this, ask your network administrator.
# If your host doesn't have a registered DNS name, enter its IP address here.
# You will have to access it by its address (e.g., http://123.45.67.89/)
# anyway, and this will make redirections work in a sensible way.
#
# 127.0.0.1 is the TCP/IP local loop-back address, often named localhost. Your 
# machine always knows itself by this address. If you use Apache strictly for 
# local testing and development, you may use 127.0.0.1 as the server name.
#
ServerName 127.0.0.1
			</programlisting>

			<para>
				From the excert above, the "ServerName" is "127.0.0.1" (a IP address is
				usually set when the machine haven't got a valid Internet name).
			</para>
	
			<important>
				<para>
					The "ServerName" maybe not work. Your server may be configured to service
					virtual hosts. Contact the server admin for more information.
				</para>
			</important>

			<para>
				The listening port usually is 80 when Apache is a site-wide installation, and
				8080 when installed by the user. This setting is defined by the parameter
				"Listen":
			</para>

			<programlisting>
#
#Port: The port to which the standalone server listens.  Certain firewall
#products must be configured before Apache can listen to a specific port.
#Other running httpd servers will also interfere with this port.  Disable
#all firewall, security, and other services if you encounter problems.
#To help diagnose problems use the Windows NT command NETSTAT -a
#
Listem 80
			</programlisting>

			<para>
				Finally, it's necessary the server's root. This directory is the one
				the HTTP server search for files, and is set by the variable
				"DocumentRoot":
			</para>

			<programlisting>
#
# DocumentRoot: The directory out of which you will serve your
# documents. By default, all requests are taken from this directory, but
# symbolic links and aliases may be used to point to other locations.
#
DocumentRoot "/srv/www"
			</programlisting>

			<para>
				By now, you should know the server's name, port and document root. If
				the information is correct, you probably can access the URL
				"http://servername:listeningport/" and the result will be the contents
				of the file <filename>index.html</filename> (or similar) that can be
				found at the documentroot.
			</para>

		</section>

		<section id="installing-configuration-php">
			<title>
				Configuring the PHP
			</title>

			<para>
				The current version of CoTeia requires the activation of the PHP's parameter
				"register_globals". The latest PHP's version disables it by default, so it's
				neeeded to activate it, setting the variable at <filename>php.ini</filename>.

				<tip>
					<para>
						This file is usually found at <filename>/etc</filename> in Linux and Unix
						systems.
					</para>
				</tip>
			</para>

			<para>
				The except below shows the default setting for "register_globals":
	
				<programlisting>
; You should do your best to write your scripts so that they do not require
; register_globals to be on;  Using form variables as globals can easily lead
; to possible security problems, if the code is not very well thought of.
register_globals = OFF
				</programlisting>

				Please change the parameter to "ON".
			</para>

		</section>

		<section id="installing-configuration-mysql">
      <title>
        Configuring the Mysql
      </title>

			<para>
				MySQL usually doesn't require any special configuration. You just need
				the server's hostname, username, password and database's name. Ask the
				database admin to	create an username and set up a database for it.
			</para>

			<tip>
				<para>
					If you are the system admin, the installation scripts can setup this
					automatically for you.
				</para>
			</tip>

		</section>

    <section id="installing-configuration-cvs">
      <title>
        Configuring the CVS
      </title>

			<para>
				The simplest use of CVS is by creating a local repository. This is
				accomplished automatically by CoTeia's setup tool. This is the fastest
				and easiest solution. But, if desired, any other access method can be
				employed (e.g., access, using the pserver method, a remote repository).
			</para>

			<para>
				This guide doesn't cover the configuration of a remove CVS server. Ask
				your system admin for a CVS repository that can be used by CoTeia. The
				following CVS server data will be necessary: hostname (or IP address),
				access method (usually "pserver"), module, and, optionally, username
				and password.
			</para>

		</section>
				
		<section id="installing-configuration-coteia">
			<title>
				Configuring the CoTeia
			</title>

			<para>
				The only file that needs modification is <filename>config.php</filename>.
				Every parameter that must be set has information about its value. There is
				a <filename>config.php.eg</filename> in the directory
				<filename>doc/</filename> that can be used as a base configuration, just copy
				it to <filename>config.php</filename> and edit the unfilled parameters.
			</para>

			<variablelist>
				<title>Configurable parameters</title>

				<varlistentry>
					<term>CVS_METHOD</term>
					<listitem>
						<para>
							The method that will be used to access the CVS repository. Possible values
							are <emphasis>local</emphasis> and <emphasis>pserver</emphasis>.
						</para>

						<example>
							<title>Setting <emphasis>pserver</emphasis> as CVS access method</title>

							<programlisting>
$CVS_METHOD = "pserver";
							</programlisting>
						</example>
					</listitem>
				</varlistentry>

				<varlistentry>
					<term>CVS_SERVER</term>
					<listitem>
						<para>
							Computer name or IP address that hosts the CVS repository. Mandatory when
							using the <emphasis>pserver</emphasis> method, ignored for the <emphasis>
							local</emphasis> method.
						</para>

						<example>
							<title>Setting the local machine as CVS server</title>
							<programlisting>
$CVS_SERVER = "localhost";
							</programlisting>
						</example>
					</listitem>
				</varlistentry>

				<varlistentry>
					<term>CVS_ROOT</term>
					<listitem>
						<para>
							The repository path at CVS's server. That's usually informed your system
							admin when accessing a remove repository with the method <emphasis>pserver
							</emphasis>. When using the method <emphasis>local</emphasis>, it's the
							directory that holds the cvs repository. Such directory must be visible
							(and writable) by the httpd daemon.
						</para>

						<example>
							<title>Setting the cvsroot to a local directory, inside the CoTeia's tree</title>
							<programlisting>
$CVS_ROOT = "$PATH_COWEB/local_cvs";
							</programlisting>
						</example>
					</listitem>
				</varlistentry>

				<varlistentry>
					<term>CVS_MODULE</term>
					<listitem>
						<para>
							A CVS repository is organized into modules, usually with individual access
							policies. This parameter holds the module name that CoTeia will have
							access (full access, writing and reading). Your system admin must have
							informed you this data. If using an local repository, this is a subdirectory
							within the <emphasis>CVS_ROOT</emphasis> (the setup script will automatically
							create it).
						</para>

						<example>
							<title>Setting the module to "html"</title>
							<programlisting>
$CVS_MODULE = "html";
							</programlisting>
						</example>
					</listitem>
				</varlistentry>

				<varlistentry>
					<term>CVS_USERNAME</term>
					<listitem>
						<para>
						</para>

						<example>
							<title></title>
							<programlisting>
$CVS_USERNAME = "";
							</programlisting>
						</example>
					</listitem>
				</varlistentry>

				<varlistentry>
					<term>CVS_PASSWORD</term>
					<listitem>
						<para>
						</para>

						<example>
							<title></title>
							<programlisting>
$CVS_PASSWORD = "";
							</programlisting>
						</example>
					</listitem>
				</varlistentry>

				<varlistentry>
					<term>CVS_CHECKOUT_DIR</term>
					<listitem>
						<para>
						</para>

						<example>
							<title></title>
							<programlisting>
$CVS_CHECKOUT_DIR = $PATH_COWEB . "/repository";
							</programlisting>
						</example>
					</listitem>
				</varlistentry>

				<varlistentry>
					<term>CVS_PASSFILE</term>
					<listitem>
						<para>
						</para>

						<example>
							<title></title>
							<programlisting>
$CVS_PASSFILE = $CVS_CHECKOUT_DIR . "/.cvspass";
							</programlisting>
						</example>
					</listitem>
				</varlistentry>

				<varlistentry>
					<term></term>
					<listitem>
						<para>
						</para>

						<example>
							<title></title>
							<programlisting>
$DEFAULT_USER = "";
							</programlisting>
						</example>
					</listitem>
				</varlistentry>

			</variablelist>

			<para>
				CoTeia depends heavyly on <filename>config.php</filename>. Please, check the
				file correctness running "php -l <filename>config.php</filename>".
			</para>

			<para>
				After setting the <filename>config.php</filename>, run tun the setup
				script (<filename>tables/setup.php</filename>):
			</para>

			<programlisting>
php tables/setup.php
			</programlisting>
	
			<para>
				Next, the SQL scripts (compiled by <filename>setup.php</filename>) should be
				run againt the MySQL. The files are:

				<orderedlist>
					<listitem>
						<para>
							coteia.sql
						</para>
					</listitem>

					<listitem>
						<para>
							chatserver.sql
						</para>
					</listitem>

					<listitem>
						<para>
							coweb-users.sql
						</para>
					</listitem>

					<listitem>
						<para>
							eclass.sql
						</para>
					</listitem>

					<listitem>
						<para>
							groupnode.sql
						</para>
					</listitem>
				</orderedlist>

				You can run the files using the console MySQL client. Use the "\." statement
				followed by the filename:

				<programlisting>
# mysql -h [mysql_hostname] -u [username] -p

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3 to server version: 4.0.18-nt

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

Mysql>

Mysql> \. coteia.sql;
				</programlisting>

				<important>
					<para>
						The SQL scripts may require some modifications, especially about the username's
						creation.
					</para>
				</important>
			</para>
		</section>

	</section>

  <section id="installing-upgrading">
    <title>
      Upgrading
    </title>

		<para>
			When upgrading from an old CoTeia, there're several factors that must be
			checked: CVS, new transformation stylesheet, etc. The easiest solution is:

			<orderedlist>
				<listitem>
					<para>
						Entirely remove the directories $CVS_CHECKOUT_DIR, $PATH_ARQUIVOS,
						$PATH_XHTML and $PATH_XML.
					</para>
				</listitem>

				<listitem>
					<para>
						Run <filename>setup.php</filename> (the setup script).
					</para>
				</listitem>
			</orderedlist>
		</para>

		<para>
			The first access to every page will be slower as the CVS and HTML page will be
			compiled, but the procedure is much easier than rebuild every file again (at least
			for big installations).
		</para>

	</section>

</chapter>
